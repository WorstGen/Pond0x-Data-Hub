<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PONDü§ùX BUBBLE POPPER</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Light mode variables */
      --bg-gradient: linear-gradient(90deg, #0ec404 0%, #25db0f 15%, #13FF22 35%, #13FF22 65%, #25db0f 85%, #0ec404 100%);
      --primary-color: #7b3aad;
      --accent-color: #FF13F0;
      --secondary-accent: #f19cfd;
      --navbar-bg: #FF13F0;
      --nav-text: #13FF22;
      --card-bg: rgba(123, 58, 173, 0.1);
      --card-border: rgba(241, 156, 253, 0.3);
      --shadow-primary: rgba(123, 58, 173, 0.2);
      --shadow-accent: rgba(241, 156, 253, 0.4);
      --text-primary: #7b3aad;
    }

    [data-theme="dark"] {
      /* Dark mode variables */
      --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 20%, #16213e 40%, #1a1a2e 60%, #0f0f0f 80%, #0a0a0a 100%);
      --primary-color: #e0b3ff;
      --accent-color: #ff3df0;
      --secondary-accent: #bd7cfd;
      --navbar-bg: #1a1a2e;
      --nav-text: #00ff88;
      --card-bg: rgba(26, 26, 46, 0.8);
      --card-border: rgba(189, 124, 253, 0.4);
      --shadow-primary: rgba(189, 124, 253, 0.3);
      --shadow-accent: rgba(255, 61, 240, 0.5);
      --text-primary: #e0b3ff;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0ec404 0%, #25db0f 25%, #13FF22 50%, #25db0f 75%, #0ec404 100%);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      color: var(--text-primary);
      min-height: 100vh;
      padding-top: 60px;
      overflow-x: hidden;
      transition: all 0.3s ease;
    }

    [data-theme="dark"] body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #1a1a2e 75%, #0f0f0f 100%);
      background-size: 400% 400%;
      animation: gradientShift 10s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Navigation */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--navbar-bg);
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 60px;
    }

    .nav-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--nav-text);
      cursor: pointer;
      padding: 0.5rem;
      z-index: 1001;
    }

    .nav-links {
      position: fixed;
      top: 60px;
      left: -100%;
      width: 80%;
      max-width: 300px;
      height: calc(100vh - 60px);
      background: var(--navbar-bg);
      display: flex;
      flex-direction: column;
      padding: 2rem 1rem;
      gap: 1rem;
      transition: left 0.3s ease;
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
    }

    .nav-links.show {
      left: 0;
    }

    .nav-links a {
      color: var(--nav-text);
      text-decoration: none;
      font-weight: bold;
      font-size: 1.1rem;
      padding: 1rem;
      border-radius: 10px;
      transition: all 0.3s ease;
      text-align: center;
    }

    .nav-links a:hover, .nav-links a:focus {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(10px);
    }

    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      transition: transform 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.2);
    }

    /* Game Container */
    .game-wrapper {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .game-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .game-title {
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(45deg, var(--accent-color), var(--secondary-accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 30px var(--shadow-accent);
    }

    .game-subtitle {
      font-size: 1.1rem;
      opacity: 0.8;
      color: var(--text-primary);
    }

    .game-container {
      position: relative;
      width: 100%;
      height: 70vh;
      min-height: 500px;
      max-height: 700px;
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.05) 0%, 
        rgba(123, 58, 173, 0.1) 100%);
      border-radius: 20px;
      overflow: hidden;
      border: 3px solid var(--card-border);
      box-shadow: 0 20px 60px var(--shadow-primary);
      backdrop-filter: blur(20px);
      cursor: crosshair;
    }

    [data-theme="dark"] .game-container {
      background: linear-gradient(135deg, 
        rgba(26, 26, 46, 0.4) 0%, 
        rgba(189, 124, 253, 0.1) 100%);
    }

    /* HUD */
    .game-hud {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 1rem;
      background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .hud-item {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 0.5rem 1rem;
      border-radius: 25px;
      font-weight: bold;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }

    .game-button {
      background: linear-gradient(135deg, var(--accent-color), var(--secondary-accent));
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px var(--shadow-accent);
      font-size: 0.9rem;
    }

    .game-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow-accent);
    }

    .game-button:active {
      transform: translateY(0);
    }

    /* Crosshair */
    .crosshair {
      position: absolute;
      width: 30px;
      height: 30px;
      pointer-events: none;
      z-index: 15;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .crosshair::before,
    .crosshair::after {
      content: '';
      position: absolute;
      background: var(--accent-color);
      box-shadow: 0 0 10px currentColor;
    }

    .crosshair::before {
      width: 20px;
      height: 2px;
      top: 14px;
      left: 5px;
    }

    .crosshair::after {
      width: 2px;
      height: 20px;
      top: 5px;
      left: 14px;
    }

    /* Bubble Styles */
    .bubble {
      position: absolute;
      border-radius: 50%;
      cursor: crosshair;
      transition: transform 0.1s ease;
      z-index: 5;
      will-change: transform;
    }

    .bubble::before {
      content: '';
      position: absolute;
      top: 15%;
      left: 25%;
      width: 30%;
      height: 30%;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      filter: blur(3px);
    }

    .bubble.hit {
      animation: explode 0.3s ease-out forwards;
    }

    @keyframes explode {
      0% { transform: scale(1) rotate(0deg); opacity: 1; }
      50% { transform: scale(1.5) rotate(180deg); opacity: 0.7; }
      100% { transform: scale(2.5) rotate(360deg); opacity: 0; }
    }

    /* Particle Effects */
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--accent-color);
      border-radius: 50%;
      pointer-events: none;
      z-index: 12;
      animation: particle-fly 0.8s ease-out forwards;
    }

    @keyframes particle-fly {
      0% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0) translate(var(--vx, 0), var(--vy, 0));
      }
    }

    /* Score Popup */
    .score-popup {
      position: absolute;
      font-weight: bold;
      font-size: 1.5rem;
      color: var(--accent-color);
      pointer-events: none;
      z-index: 15;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      animation: scoreFloat 1s ease-out forwards;
    }

    @keyframes scoreFloat {
      0% { 
        opacity: 1; 
        transform: translateY(0) scale(0.5); 
      }
      50% { 
        transform: translateY(-30px) scale(1.2); 
      }
      100% { 
        opacity: 0; 
        transform: translateY(-60px) scale(0.8); 
      }
    }

    /* Game Over Screen */
    .game-over {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(15px);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20;
      text-align: center;
      gap: 1.5rem;
      color: white;
    }

    .game-over.show {
      display: flex;
    }

    .game-over h2 {
      font-size: 2.5rem;
      color: var(--accent-color);
      text-shadow: 0 0 20px currentColor;
    }

    .final-stats {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--secondary-accent);
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .name-input {
      padding: 1rem;
      border: 2px solid var(--card-border);
      border-radius: 15px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1.1rem;
      text-align: center;
      backdrop-filter: blur(10px);
      width: 250px;
      max-width: 90%;
    }

    .name-input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 20px var(--shadow-accent);
    }

    .name-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    /* Leaderboard */
    .leaderboard {
      margin-top: 3rem;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--card-border);
      box-shadow: 0 15px 50px var(--shadow-primary);
    }

    .leaderboard h3 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
      background: linear-gradient(45deg, var(--accent-color), var(--secondary-accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .leaderboard-list {
      display: grid;
      gap: 0.8rem;
    }

    .leaderboard-entry {
      display: grid;
      grid-template-columns: 40px 1fr auto auto;
      gap: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid var(--card-border);
      align-items: center;
      transition: all 0.3s ease;
    }

    .leaderboard-entry:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    .rank {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--accent-color);
      text-align: center;
    }

    .rank.gold { color: #FFD700; }
    .rank.silver { color: #C0C0C0; }
    .rank.bronze { color: #CD7F32; }

    .player-name {
      font-weight: bold;
      color: var(--text-primary);
    }

    .score {
      font-weight: bold;
      color: var(--secondary-accent);
    }

    .accuracy {
      font-size: 0.9rem;
      opacity: 0.8;
      color: var(--text-primary);
    }

    /* Mobile Optimizations */
    @media (max-width: 768px) {
      .game-title {
        font-size: 2rem;
      }

      .game-container {
        height: 60vh;
        min-height: 400px;
      }

      .game-hud {
        padding: 0.8rem;
        gap: 0.5rem;
      }

      .hud-item {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
      }

      .game-button {
        padding: 0.6rem 1rem;
        font-size: 0.8rem;
      }

      .final-stats {
        gap: 1rem;
      }

      .leaderboard {
        margin-top: 2rem;
        padding: 1.5rem;
      }

      .leaderboard-entry {
        grid-template-columns: 30px 1fr auto;
        gap: 0.8rem;
        padding: 0.8rem;
      }

      .accuracy {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <button class="nav-toggle" onclick="toggleNav()">‚ò∞</button>
      <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>
    </div>
    <div class="nav-links" id="navLinks">
      <a href="#game">BUBBLE POPPER</a>
      <a href="#leaderboard">LEADERBOARD</a>
      <a href="https://worstgen.github.io/Pond0x-Data-Hub/" target="_blank">DATA HUB</a>
    </div>
  </nav>

  <div class="game-wrapper">
    <!-- Game Header -->
    <div class="game-header">
      <h1 class="game-title">üí• PONDü§ùX BUBBLE POPPER</h1>
      <p class="game-subtitle">69 seconds ‚Ä¢ 4.20 waves ‚Ä¢ Rising bubbles with physics</p>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="gameContainer">
      <div class="crosshair" id="crosshair"></div>
      
      <div class="game-hud">
        <div class="hud-item">Score: <span id="score">0</span></div>
        <div class="hud-item">Time: <span id="timer">69</span>s</div>
        <div class="hud-item">Wave: <span id="wave">1</span>/4.20</div>
        <button class="game-button" id="playBtn" onclick="startGame()">START GAME</button>
        <button class="game-button" id="pauseBtn" onclick="togglePause()" style="display: none;">PAUSE</button>
      </div>

      <div class="game-over" id="gameOver">
        <h2>üéâ BUBBLES POPPED!</h2>
        <div class="final-stats">
          <div class="stat">
            <div class="stat-value" id="finalScore">0</div>
            <div class="stat-label">Final Score</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="finalAccuracy">0%</div>
            <div class="stat-label">Accuracy</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="finalWave">1</div>
            <div class="stat-label">Wave Reached</div>
          </div>
        </div>
        <input type="text" class="name-input" id="playerName" placeholder="Enter your codename" maxlength="12">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
          <button class="game-button" onclick="submitScore()">SUBMIT SCORE</button>
          <button class="game-button" onclick="playAgain()">PLAY AGAIN</button>
        </div>
      </div>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard" id="leaderboard">
      <h3>üèÜ TOP POPPERS</h3>
      <div class="leaderboard-list" id="leaderboardList">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

<script>
// Game state
let game = {
  isPlaying: false,
  isPaused: false,
  score: 0,
  wave: 1,
  maxWaves: 4.20,
  timeRemaining: 69,
  hits: 0,
  shots: 0,
  bubbles: [],
  spawnRate: 1200,
  bubbleSpeed: 1.5,
  maxBubbles: 6,
  animationId: null,
  spawnTimer: null,
  gameTimer: null
};

// Theme management
function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme') || 'light';
  const newTheme = current === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
}

// Navigation
function toggleNav() {
  document.getElementById('navLinks').classList.toggle('show');
}

// Bubble types with different behaviors
const bubbleTypes = [
  { size: 60, speed: 1, points: 10, color: '#FF13F0' },
  { size: 45, speed: 1.5, points: 20, color: '#13FF22' },
  { size: 35, speed: 2, points: 30, color: '#f19cfd' },
  { size: 25, speed: 2.5, points: 50, color: '#bd7cfd' },
  { size: 80, speed: 0.8, points: 5, color: '#FF6B6B' },
];

// Game functions
function startGame() {
  if (game.isPlaying) return;
  
  // Reset game state
  game.isPlaying = true;
  game.isPaused = false;
  game.score = 0;
  game.wave = 1;
  game.timeRemaining = 69;
  game.hits = 0;
  game.shots = 0;
  game.bubbles = [];
  game.spawnRate = 1200;
  game.bubbleSpeed = 1.5;
  game.maxBubbles = 6;
  
  // Clear any existing timers
  if (game.gameTimer) clearInterval(game.gameTimer);
  if (game.spawnTimer) clearTimeout(game.spawnTimer);
  if (game.animationId) cancelAnimationFrame(game.animationId);
  
  // Update UI
  document.getElementById('playBtn').style.display = 'none';
  document.getElementById('pauseBtn').style.display = 'block';
  document.getElementById('gameOver').classList.remove('show');
  
  updateHUD();
  gameLoop();
  spawnBubbles();
  startTimer();
  
  // Add mouse tracking
  const container = document.getElementById('gameContainer');
  const crosshair = document.getElementById('crosshair');
  
  container.addEventListener('mousemove', function(e) {
    if (!game.isPlaying) return;
    const rect = container.getBoundingClientRect();
    crosshair.style.left = (e.clientX - rect.left - 15) + 'px';
    crosshair.style.top = (e.clientY - rect.top - 15) + 'px';
    crosshair.style.opacity = '1';
  });
  
  container.addEventListener('mouseleave', function() {
    crosshair.style.opacity = '0';
  });
  
  container.addEventListener('click', function(e) {
    if (!game.isPlaying || game.isPaused) return;
    game.shots++;
    
    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    // Check for bubble hits
    let hit = false;
    for (let i = game.bubbles.length - 1; i >= 0; i--) {
      const bubble = game.bubbles[i];
      const dx = x - (bubble.x + bubble.size/2);
      const dy = y - (bubble.y + bubble.size/2);
      const distance = Math.sqrt(dx*dx + dy*dy);
      
      if (distance <= bubble.size/2) {
        hitBubble(bubble, i);
        hit = true;
        break;
      }
    }
    
    updateHUD();
  });
}

function togglePause() {
  if (!game.isPlaying) return;
  game.isPaused = !game.isPaused;
  document.getElementById('pauseBtn').textContent = game.isPaused ? 'RESUME' : 'PAUSE';
  
  if (game.isPaused) {
    if (game.gameTimer) clearInterval(game.gameTimer);
    if (game.spawnTimer) clearTimeout(game.spawnTimer);
    if (game.animationId) cancelAnimationFrame(game.animationId);
  } else {
    gameLoop();
    spawnBubbles();
    startTimer();
  }
}

function startTimer() {
  game.gameTimer = setInterval(() => {
    if (game.isPaused) return;
    
    game.timeRemaining--;
    updateHUD();
    
    if (game.timeRemaining <= 0 || game.wave > game.maxWaves) {
      endGame();
    }
  }, 1000);
}

function gameLoop() {
  if (!game.isPlaying || game.isPaused) return;
  
  // Move bubbles upward
  for (let i = game.bubbles.length - 1; i >= 0; i--) {
    const bubble = game.bubbles[i];
    
    // Simple physics - bubbles rise with slight wobble
    bubble.y -= bubble.speed * game.bubbleSpeed;
    bubble.wobbleOffset += 0.1;
    
    const wobbleX = Math.sin(bubble.wobbleOffset) * 10;
    
    // Update position
    bubble.element.style.left = (bubble.x + wobbleX) + 'px';
    bubble.element.style.top = bubble.y + 'px';
    
    // Remove bubbles that went off screen
    if (bubble.y < -bubble.size - 50) {
      bubble.element.remove();
      game.bubbles.splice(i, 1);
    }
  }
  
  // Check wave progression
  checkWaveProgression();
  
  game.animationId = requestAnimationFrame(gameLoop);
}

function spawnBubbles() {
  if (!game.isPlaying || game.isPaused) return;
  
  if (game.bubbles.length < game.maxBubbles && Math.random() < 0.7) {
    createBubble();
  }
  
  game.spawnTimer = setTimeout(spawnBubbles, game.spawnRate);
}

function createBubble() {
  const container = document.getElementById('gameContainer');
  const type = bubbleTypes[Math.floor(Math.random() * bubbleTypes.length)];
  
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.style.width = type.size + 'px';
  bubble.style.height = type.size + 'px';
  bubble.style.background = `radial-gradient(circle at 30% 30%, ${type.color}dd, ${type.color}99, ${type.color}44)`;
  bubble.style.boxShadow = `0 0 20px ${type.color}66, inset 0 0 20px rgba(255,255,255,0.2)`;
  
  const x = Math.random() * (container.clientWidth - type.size);
  const startY = container.clientHeight + type.size;
  
  bubble.style.left = x + 'px';
  bubble.style.top = startY + 'px';
  
  const bubbleData = {
    element: bubble,
    x: x,
    y: startY,
    size: type.size,
    speed: type.speed,
    points: type.points,
    color: type.color,
    wobbleOffset: Math.random() * Math.PI * 2
  };
  
  container.appendChild(bubble);
  game.bubbles.push(bubbleData);
}

function hitBubble(bubble, index) {
  game.hits++;
  game.score += bubble.points;
  
  // Create explosion effect
  createExplosion(bubble.x + bubble.size/2, bubble.y + bubble.size/2, bubble.color);
  
  // Show score popup
  showScorePopup(bubble.x + bubble.size/2, bubble.y + bubble.size/2, '+' + bubble.points);
  
  // Remove bubble
  bubble.element.classList.add('hit');
  setTimeout(() => {
    if (bubble.element.parentNode) {
      bubble.element.remove();
    }
  }, 300);
  
  game.bubbles.splice(index, 1);
}

function createExplosion(x, y, color) {
  const container = document.getElementById('gameContainer');
  const particleCount = 8;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.background = color;
    particle.style.left = x + 'px';
    particle.style.top = y + 'px';
    
    const angle = (i / particleCount) * Math.PI * 2;
    const velocity = 50 + Math.random() * 30;
    const vx = Math.cos(angle) * velocity;
    const vy = Math.sin(angle) * velocity;
    
    particle.style.setProperty('--vx', vx + 'px');
    particle.style.setProperty('--vy', vy + 'px');
    
    container.appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.remove();
      }
    }, 800);
  }
}

function showScorePopup(x, y, text) {
  const popup = document.createElement('div');
  popup.className = 'score-popup';
  popup.textContent = text;
  popup.style.left = x + 'px';
  popup.style.top = y + 'px';
  
  document.getElementById('gameContainer').appendChild(popup);
  setTimeout(() => {
    if (popup.parentNode) {
      popup.remove();
    }
  }, 1000);
}

function checkWaveProgression() {
  const newWave = Math.floor((game.score / 150) * 10) / 10 + 1; // More granular wave progression
  if (newWave > game.wave && newWave <= game.maxWaves) {
    game.wave = newWave;
    game.spawnRate = Math.max(200, game.spawnRate - 150);
    game.bubbleSpeed = Math.min(3.5, game.bubbleSpeed + 0.3);
    game.maxBubbles = Math.min(12, game.maxBubbles + 2);
    
    // Wave complete notification - show decimal waves too
    const waveText = newWave % 1 === 0 ? `WAVE ${newWave.toFixed(0)}!` : `WAVE ${newWave.toFixed(1)}!`;
    showScorePopup(
      document.getElementById('gameContainer').clientWidth / 2,
      document.getElementById('gameContainer').clientHeight / 2,
      waveText
    );
  }
  
  // Check if max waves reached
  if (game.wave >= game.maxWaves) {
    setTimeout(() => endGame(), 1000);
  }
}

function updateHUD() {
  document.getElementById('score').textContent = game.score.toLocaleString();
  document.getElementById('wave').textContent = game.wave % 1 === 0 ? game.wave.toFixed(0) : game.wave.toFixed(1);
  document.getElementById('timer').textContent = game.timeRemaining;
}

function endGame() {
  game.isPlaying = false;
  
  // Clear all timers and animations
  if (game.spawnTimer) clearTimeout(game.spawnTimer);
  if (game.gameTimer) clearInterval(game.gameTimer);
  if (game.animationId) cancelAnimationFrame(game.animationId);
  
  // Clear all bubbles
  game.bubbles.forEach(bubble => {
    if (bubble.element.parentNode) {
      bubble.element.remove();
    }
  });
  game.bubbles = [];
  
  // Show final stats
  const accuracy = game.shots > 0 ? Math.round((game.hits / game.shots) * 100) : 100;
  document.getElementById('finalScore').textContent = game.score.toLocaleString();
  document.getElementById('finalAccuracy').textContent = accuracy + '%';
  document.getElementById('finalWave').textContent = game.wave;
  
  document.getElementById('gameOver').classList.add('show');
  document.getElementById('playBtn').style.display = 'block';
  document.getElementById('pauseBtn').style.display = 'none';
  
  // Remove mouse events
  const container = document.getElementById('gameContainer');
  container.replaceWith(container.cloneNode(true));
  document.getElementById('crosshair').style.opacity = '0';
}

function playAgain() {
  document.getElementById('gameOver').classList.remove('show');
  document.getElementById('playerName').value = '';
  startGame();
}

// In-memory leaderboard system
const leaderboard = {
  scores: [],
  
  getScores() {
    return this.scores;
  },
  
  addScore(name, score, accuracy, wave) {
    this.scores.push({
      name: name || 'Anonymous',
      score: score,
      accuracy: accuracy,
      wave: wave,
      date: new Date().toISOString().split('T')[0]
    });
    
    this.scores.sort((a, b) => b.score - a.score);
    this.scores = this.scores.slice(0, 10);
    
    this.render();
    return this.scores.findIndex(s => s.name === name && s.score === score) + 1;
  },
  
  render() {
    const scores = this.getScores();
    const container = document.getElementById('leaderboardList');
    
    if (scores.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 2rem; opacity: 0.7;">
          No scores yet. Be the first to pop some bubbles! üí•
        </div>`;
      return;
    }
    
    container.innerHTML = scores.map((entry, index) => {
      let rankClass = '';
      if (index === 0) rankClass = 'gold';
      else if (index === 1) rankClass = 'silver';
      else if (index === 2) rankClass = 'bronze';
      
      return `
        <div class="leaderboard-entry">
          <div class="rank ${rankClass}">#${index + 1}</div>
          <div class="player-name">${this.escapeHtml(entry.name)}</div>
          <div class="score">${entry.score.toLocaleString()}</div>
          <div class="accuracy">${entry.accuracy}%</div>
        </div>
      `;
    }).join('');
  },
  
  escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
};

function submitScore() {
  const name = document.getElementById('playerName').value.trim();
  if (!name) {
    alert('Enter your codename, popper! üí•');
    return;
  }
  
  const accuracy = game.shots > 0 ? Math.round((game.hits / game.shots) * 100) : 100;
  const rank = leaderboard.addScore(name, game.score, accuracy, game.wave);
  
  document.getElementById('gameOver').classList.remove('show');
  document.getElementById('playerName').value = '';
  
  // Scroll to leaderboard and highlight new entry
  setTimeout(() => {
    document.getElementById('leaderboard').scrollIntoView({ 
      behavior: 'smooth' 
    });
    
    // Highlight the new entry
    const entries = document.querySelectorAll('.leaderboard-entry');
    if (entries[rank - 1]) {
      entries[rank - 1].style.background = 'rgba(255, 19, 240, 0.2)';
      entries[rank - 1].style.border = '2px solid var(--accent-color)';
      setTimeout(() => {
        entries[rank - 1].style.background = '';
        entries[rank - 1].style.border = '1px solid var(--card-border)';
      }, 3000);
    }
  }, 500);
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Set initial theme
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  if (prefersDark) {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.querySelector('.theme-toggle').textContent = 'üåô';
  }
  
  // Load leaderboard with sample data
  leaderboard.addScore('BubbleKing', 2800, 89, 9);
  leaderboard.addScore('POND_Sniper', 2350, 95, 8);
  leaderboard.addScore('FrogPopper', 1950, 78, 7);
  leaderboard.addScore('Lily_Pop', 1650, 82, 6);
  leaderboard.addScore('AquaPop', 1200, 75, 5);
  
  // Handle Enter key for name input
  document.getElementById('playerName').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      submitScore();
    }
  });
  
  // Close nav when clicking outside
  document.addEventListener('click', function(e) {
    const nav = document.getElementById('navLinks');
    const toggle = document.querySelector('.nav-toggle');
    
    if (nav.classList.contains('show') && 
        !nav.contains(e.target) && 
        !toggle.contains(e.target)) {
      nav.classList.remove('show');
    }
  });
  
  // Prevent context menu on game area
  document.getElementById('gameContainer').addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });
});
</script>

</body>
</html>
